{"version":3,"sources":["webpack:///bulbs-page-state.js","webpack:///./elements/bulbs-page-state/bulbs-page-state.js"],"names":["webpackJsonp","0","module","exports","__webpack_require__","_defaults","obj","defaults","keys","Object","getOwnPropertyNames","i","length","key","value","getOwnPropertyDescriptor","configurable","undefined","defineProperty","_classCallCheck","instance","Constructor","TypeError","_possibleConstructorReturn","self","call","ReferenceError","_inherits","subClass","superClass","prototype","create","constructor","enumerable","writable","setPrototypeOf","_createClass","defineProperties","target","props","descriptor","protoProps","staticProps","_util","_register","USER_EVENTS","BulbsPageState","_BulbsHTMLElement","this","apply","arguments","createdCallback","handleUserEvent","bind","attachedCallback","_this2","requireAttribute","InViewMonitor","add","document","readyState","handleDocumentReady","window","addEventListener","forEach","eventName","detachedCallback","remove","maybeAnchorElement","_this3","userIntervened","shouldAnchorScroll","offsetParent","scrollTop","offsetTop","requestAnimationFrame","_ref","_this4","type","removeEventListener","_this5","handlePageStart","history","replaceState","getAttribute","get","anchorOnLoad","hasAttribute","isCurrentPage","location","pathname","JSON","parse","BulbsHTMLElement","registerElement","232"],"mappings":"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","file":"bulbs-page-state.js","sourcesContent":["webpackJsonp([12],{\n\n/***/ 0:\n/***/ function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t  value: true\n\t});\n\t\n\tvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\t\n\tvar _util = __webpack_require__(176);\n\t\n\tvar _register = __webpack_require__(2);\n\t\n\t__webpack_require__(232);\n\t\n\tfunction _defaults(obj, defaults) { var keys = Object.getOwnPropertyNames(defaults); for (var i = 0; i < keys.length; i++) { var key = keys[i]; var value = Object.getOwnPropertyDescriptor(defaults, key); if (value && value.configurable && obj[key] === undefined) { Object.defineProperty(obj, key, value); } } return obj; }\n\t\n\tfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\t\n\tfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\t\n\tfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : _defaults(subClass, superClass); }\n\t\n\tvar USER_EVENTS = ['scroll', 'mousedown', 'wheel', 'DOMMouseScroll', 'mousewheel', 'keyup'];\n\t\n\t// FIXME: do this\n\t// let prefixCount = 0;\n\t\n\tvar BulbsPageState = function (_BulbsHTMLElement) {\n\t  _inherits(BulbsPageState, _BulbsHTMLElement);\n\t\n\t  function BulbsPageState() {\n\t    _classCallCheck(this, BulbsPageState);\n\t\n\t    return _possibleConstructorReturn(this, _BulbsHTMLElement.apply(this, arguments));\n\t  }\n\t\n\t  BulbsPageState.prototype.createdCallback = function createdCallback() {\n\t    this.handleUserEvent = this.handleUserEvent.bind(this);\n\t  };\n\t\n\t  BulbsPageState.prototype.attachedCallback = function attachedCallback() {\n\t    var _this2 = this;\n\t\n\t    this.requireAttribute('pushstate-url');\n\t    _util.InViewMonitor.add(this);\n\t\n\t    if (document.readyState === 'complete') {\n\t      this.handleDocumentReady();\n\t    } else {\n\t      window.addEventListener('DOMContentLoaded', function () {\n\t        return _this2.handleDocumentReady();\n\t      });\n\t    }\n\t\n\t    USER_EVENTS.forEach(function (eventName) {\n\t      window.addEventListener(eventName, _this2.handleUserEvent);\n\t    });\n\t\n\t    // FIXME:\n\t    // this.ga = makePrefixedGa(\n\t    //   `bulbs-page-state-${prefixCount++}`,\n\t    //   this.gaDimensions,\n\t    // );\n\t  };\n\t\n\t  BulbsPageState.prototype.detachedCallback = function detachedCallback() {\n\t    _util.InViewMonitor.remove(this);\n\t  };\n\t\n\t  BulbsPageState.prototype.maybeAnchorElement = function maybeAnchorElement() {\n\t    var _this3 = this;\n\t\n\t    if (this.userIntervened) {\n\t      return;\n\t    } else if (this.shouldAnchorScroll) {\n\t      this.offsetParent.scrollTop = this.offsetTop;\n\t      requestAnimationFrame(function () {\n\t        return _this3.maybeAnchorElement();\n\t      });\n\t    }\n\t  };\n\t\n\t  BulbsPageState.prototype.handleUserEvent = function handleUserEvent(_ref) {\n\t    var _this4 = this;\n\t\n\t    var type = _ref.type;\n\t\n\t    if (type === 'DOMMouseScroll' || type === 'mousewheel' || type === 'wheel' || type === 'mousedown' || type === 'keyup') {\n\t      this.userIntervened = true;\n\t      USER_EVENTS.forEach(function (eventName) {\n\t        window.removeEventListener(eventName, _this4.handleUserEvent);\n\t      });\n\t    }\n\t  };\n\t\n\t  BulbsPageState.prototype.handleDocumentReady = function handleDocumentReady() {\n\t    var _this5 = this;\n\t\n\t    this.maybeAnchorElement();\n\t    // Bind this event here to avoid triggering\n\t    //   extra page views while scrolling to element\n\t    this.addEventListener('pagestart', function () {\n\t      return _this5.handlePageStart();\n\t    });\n\t  };\n\t\n\t  BulbsPageState.prototype.handlePageStart = function handlePageStart() {\n\t    history.replaceState({}, this.getAttribute('pushstate-title'), this.getAttribute('pushstate-url'));\n\t\n\t    // FIXME: do this\n\t    // if (!this.trackedPageView) {\n\t    //   if (this.hasAttribute('ga-dimensions') {\n\t    //     this.trackedPageView = true;\n\t    //     this.ga.send('event', 'pageview', this.getAttribute('pushstate-url');\n\t    //   }\n\t    // }\n\t  };\n\t\n\t  _createClass(BulbsPageState, [{\n\t    key: 'shouldAnchorScroll',\n\t    get: function get() {\n\t      var anchorOnLoad = this.hasAttribute('anchor-on-load');\n\t      var isCurrentPage = this.getAttribute('pushstate-url') === location.pathname;\n\t      return anchorOnLoad && isCurrentPage;\n\t    }\n\t  }, {\n\t    key: 'gaDimensions',\n\t    get: function get() {\n\t      if (this.hasAttribute('ga-dimensions')) {\n\t        return JSON.parse(this.getAttribute('ga-dimensions'));\n\t      }\n\t      return {};\n\t    }\n\t  }]);\n\t\n\t  return BulbsPageState;\n\t}(_register.BulbsHTMLElement);\n\t\n\texports.default = BulbsPageState;\n\t\n\t\n\t(0, _register.registerElement)('bulbs-page-state', BulbsPageState);\n\n/***/ },\n\n/***/ 232:\n/***/ function(module, exports) {\n\n\t// removed by extract-text-webpack-plugin\n\n/***/ }\n\n});\n\n\n/** WEBPACK FOOTER **\n ** bulbs-page-state.js\n **/","import { InViewMonitor } from 'bulbs-elements/util';\nimport {\n  registerElement,\n  BulbsHTMLElement,\n} from 'bulbs-elements/register';\nimport './bulbs-page-state.scss';\n\nconst USER_EVENTS = [\n  'scroll', 'mousedown', 'wheel', 'DOMMouseScroll', 'mousewheel', 'keyup',\n];\n\n// FIXME: do this\n// let prefixCount = 0;\nexport default class BulbsPageState extends BulbsHTMLElement {\n  createdCallback () {\n    this.handleUserEvent = this.handleUserEvent.bind(this);\n  }\n\n  attachedCallback () {\n    this.requireAttribute('pushstate-url');\n    InViewMonitor.add(this);\n\n    if (document.readyState === 'complete') {\n      this.handleDocumentReady();\n    }\n    else {\n      window.addEventListener('DOMContentLoaded', () => this.handleDocumentReady());\n    }\n\n    USER_EVENTS.forEach((eventName) => {\n      window.addEventListener(eventName, this.handleUserEvent);\n    });\n\n    // FIXME:\n    // this.ga = makePrefixedGa(\n    //   `bulbs-page-state-${prefixCount++}`,\n    //   this.gaDimensions,\n    // );\n  }\n\n  detachedCallback () {\n    InViewMonitor.remove(this);\n  }\n\n  get shouldAnchorScroll () {\n    let anchorOnLoad = this.hasAttribute('anchor-on-load');\n    let isCurrentPage = this.getAttribute('pushstate-url') === location.pathname;\n    return anchorOnLoad && isCurrentPage;\n  }\n\n  get gaDimensions () {\n    if (this.hasAttribute('ga-dimensions')) {\n      return JSON.parse(this.getAttribute('ga-dimensions'));\n    }\n    return {};\n  }\n\n  maybeAnchorElement () {\n    if (this.userIntervened) {\n      return;\n    }\n    else if (this.shouldAnchorScroll) {\n      this.offsetParent.scrollTop = this.offsetTop;\n      requestAnimationFrame(() => this.maybeAnchorElement());\n    }\n  }\n\n  handleUserEvent ({ type }) {\n    if(type === 'DOMMouseScroll'\n       || type === 'mousewheel'\n       || type === 'wheel'\n       || type === 'mousedown'\n       || type === 'keyup'\n      ) {\n      this.userIntervened = true;\n      USER_EVENTS.forEach((eventName) => {\n        window.removeEventListener(eventName, this.handleUserEvent);\n      });\n    }\n  }\n\n  handleDocumentReady () {\n    this.maybeAnchorElement();\n    // Bind this event here to avoid triggering\n    //   extra page views while scrolling to element\n    this.addEventListener('pagestart', () => this.handlePageStart());\n  }\n\n  handlePageStart () {\n    history.replaceState(\n      {},\n      this.getAttribute('pushstate-title'),\n      this.getAttribute('pushstate-url')\n    );\n\n    // FIXME: do this\n    // if (!this.trackedPageView) {\n    //   if (this.hasAttribute('ga-dimensions') {\n    //     this.trackedPageView = true;\n    //     this.ga.send('event', 'pageview', this.getAttribute('pushstate-url');\n    //   }\n    // }\n  }\n}\n\nregisterElement('bulbs-page-state', BulbsPageState);\n\n\n\n/** WEBPACK FOOTER **\n ** ./elements/bulbs-page-state/bulbs-page-state.js\n **/"],"sourceRoot":""}