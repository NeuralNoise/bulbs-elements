webpackJsonp([0],{0:function(e,t,a){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function l(e,t){for(var a=Object.getOwnPropertyNames(t),r=0;r<a.length;r++){var l=a[r],n=Object.getOwnPropertyDescriptor(t,l);n&&n.configurable&&void 0===e[l]&&Object.defineProperty(e,l,n)}return e}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):l(e,t))}var o=a(1),i=r(o),c=a(153),d=a(168),f=r(d),p=a(177),b=r(p),v=a(188),m=r(v);a(206);var w=function(e){function t(){return n(this,t),s(this,e.apply(this,arguments))}return u(t,e),t.prototype.initialDispatch=function(){this.store.actions.setSrc(this.props.src),this.store.actions.fetchPollData(this.props.src),this.store.actions.getCachedVoteData(this.props.src)},t.prototype.render=function(){return i["default"].createElement("div",{"data-track-action":"Poll"},i["default"].createElement(m["default"],{data:this.state,actions:this.store.actions}))},t}(f["default"]);w.displayName="BulbsPoll",w.schema=b["default"],w.propTypes={src:o.PropTypes.string.isRequired},(0,c.registerReactElement)("bulbs-poll",w)},177:function(e,t,a){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var l=a(178),n=r(l),s=a(183),u=r(s),o=a(184),i=r(o),c=a(185),d=r(c),f=a(186),p=r(f),b=a(187),v=r(b),m={poll:n["default"],selectedAnswer:u["default"],winningAnswers:i["default"],vote:d["default"],src:p["default"],now:v["default"]};t["default"]=m},178:function(e,t,a){(function(e){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function l(e){if(Array.isArray(e)){for(var t=0,a=Array(e.length);t<e.length;t++)a[t]=e[t];return a}return Array.from(e)}function n(e){return e.published&&(e.published=new Date(e.published)),e.end_date&&(e.end_date=new Date(e.end_date)),e}Object.defineProperty(t,"__esModule",{value:!0});var s=a(179),u=r(s),o=a(180),i=r(o),c={initialState:{data:{answers:[]},requestInFlight:!1},actions:{setPollTotalVotes:function(e,t){return e.data.total_votes=t,e},updateAnswerVoteCount:function(e,t){var a=(0,u["default"])(e.data.answers,function(e){return e.sodahead_id===t.answer.id}),r=void 0;return e.data.answers.forEach(function(e,t){e.id===a.id&&(r=t)}),a.total_votes=t.answer.totalVotes,e.data.answers=[].concat(l(e.data.answers.slice(0,r)),[a],l(e.data.answers.slice(r+1))),e},fetchPollData:function(e,t,a){return t||(t=a.src),a.src=t,i["default"].makeRequest(t,{credentials:"include",success:a.actions.fetchPollDataSuccess,failure:a.actions.fetchPollDataFailure,error:a.actions.fetchPollDataError}),e.requestInFlight=!0,e},fetchPollDataSuccess:function(t,a,r){return t.data=n(a),t.requestInFlight=!1,e(function(){r.actions.collectWinningAnswers(r.state.poll.data.answers)}),t},fetchPollDataFailure:function(e,t){return e.requestFailure=t,e.requestInFlight=!1,e},fetchPollDataError:function(e,t){return e.requestError=t,e.requestInFlight=!1,e},resetFetchPollData:function(t,a,r){return t.requestInFlight=!1,delete t.requestFailure,delete t.requestError,e(r.actions.fetchPollData),t}}};t["default"]=c}).call(t,a(154).setImmediate)},180:function(e,t,a){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var l=a(181),n=r(l);e.exports={makeRequest:n["default"]}},181:function(e,t,a){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function l(e){var t=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];(0,o["default"])(t.success,"makeRequest MUST have an success callback"),(0,o["default"])(t.failure,"makeRequest MUST have an failure callback"),(0,o["default"])(t.error,"makeRequest MUST have an error callback");var a=t.success,r=t.failure,l=t.error,n={success:a,failure:r,error:l},u=(0,s["default"])(t);delete u.success,delete u.failure,delete u.error,t.redirect||(u.redirect="follow"),fetch(e,u).then(function(e){var t=void 0;return e.status<300?t=e.json().then(n.success):e.status>=400&&(t=e.json().then(n.failure)),t})["catch"](n.error)}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=l;var n=a(171),s=r(n),u=a(182),o=r(u)},182:function(e,t,a){"use strict";var r=function(e,t,a,r,l,n,s,u){if(!e){var o;if(void 0===t)o=new Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var i=[a,r,l,n,s,u],c=0;o=new Error(t.replace(/%s/g,function(){return i[c++]})),o.name="Invariant Violation"}throw o.framesToPop=1,o}};e.exports=r},183:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a={initialState:{},actions:{selectAnswer:function(e,t){return e&&e.id===t.id?{}:t}}};t["default"]=a},184:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a={initialState:[],actions:{collectWinningAnswers:function(e){var t=arguments.length<=1||void 0===arguments[1]?[]:arguments[1],a=0,r=[];return t.forEach(function(e){e.total_votes===a?r.push(e):e.total_votes>a&&(a=e.total_votes,r=[e])}),r}}};t["default"]=a},185:function(e,t,a){(function(e){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function l(e){return"bulbs-poll:"+e+":vote"}Object.defineProperty(t,"__esModule",{value:!0});var n=a(180),s=r(n),u={initialState:{voted:!1},actions:{getCachedVoteData:function(e,t){var a=localStorage.getItem(l(t));return a&&(e.voted=!0,e.data=JSON.parse(a)),e},makeVoteRequest:function(e,t,a){var r=a.state.poll,l="https://onion.sodahead.com/api/polls/"+r.data.sodahead_id+"/vote/";return s["default"].makeRequest(l,{method:"post",headers:{Accept:"application/json","Content-Type":"application/json"},body:"answer="+t.sodahead_id,success:a.actions.voteRequestSuccess,failure:a.actions.voteRequestFailure,error:a.actions.voteRequestError}),e.requestInFlight=!0,e},voteRequestSuccess:function(t,a,r){return localStorage.setItem(l(r.state.src),JSON.stringify(a.vote)),e(function(){r.actions.setPollTotalVotes(a.poll.totalVotes),r.actions.updateAnswerVoteCount(a.vote),r.actions.collectWinningAnswers(r.state.poll.data.answers)}),t.voted=!0,t.data=a.vote,t.requestInFlight=!1,t},voteRequestFailure:function(e,t){return e.requestFailure=t,e.requestInFlight=!1,e},voteRequestError:function(e,t){return e.requestInFlight=!1,e.requestError=t,e},resetVoteRequest:function(e){return e.requestInFlight=!1,delete e.requestFailure,delete e.requestError,e}}};t["default"]=u}).call(t,a(154).setImmediate)},186:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a={initialState:"",actions:{setSrc:function(e,t){return t}}};t["default"]=a},187:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a={initialState:new Date};t["default"]=a},188:function(e,t,a){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function l(e){var t=e.data.poll.data,a=e.data.now,r=!t.id,l=t.published&&t.published<=a,n=t.end_date&&t.end_date<=a,u=e.data.vote.voted;return r?s["default"].createElement(o["default"],null):l?n?s["default"].createElement(b["default"],{data:e.data}):u?s["default"].createElement(f["default"],{data:e.data}):l?s["default"].createElement(c["default"],{actions:e.actions,data:e.data}):void 0:s["default"].createElement(m["default"],null)}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=l;var n=a(1),s=r(n),u=a(189),o=r(u),i=a(190),c=r(i),d=a(200),f=r(d),p=a(204),b=r(p),v=a(205),m=r(v);l.propTypes={actions:n.PropTypes.object.isRequired,data:n.PropTypes.object.isRequired}},189:function(e,t,a){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function l(){return s["default"].createElement("div",{className:"bulbs-poll-loading"},"Loading Poll...")}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=l;var n=a(1),s=r(n)},190:function(e,t,a){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function l(e){var t=e.actions,a=t.selectAnswer,r=t.makeVoteRequest,l=t.resetFetchPollData,n=t.resetVoteRequest,u=e.data,i=u.poll,d=u.selectedAnswer,p=u.vote;return s["default"].createElement("div",null,s["default"].createElement(o["default"],{poll:i}),s["default"].createElement(b["default"],{error:i.requestError,reset:l},"Could not connect to network when fetching poll data."),s["default"].createElement(b["default"],{error:p.requestError,reset:n},"Could not connect to network when placing your vote."),s["default"].createElement(c["default"],{answers:i.data.answers,selectAnswer:a,selectedAnswer:d,poll:i}),s["default"].createElement(f["default"],{selectedAnswer:d,makeVoteRequest:r}))}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=l;var n=a(1),s=r(n),u=a(191),o=r(u),i=a(193),c=r(i),d=a(198),f=r(d),p=a(199),b=r(p);l.propTypes={actions:n.PropTypes.object.isRequired,data:n.PropTypes.object.isRequired}},191:function(e,t,a){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function l(e){var t=e.poll;return s["default"].createElement("header",{className:"bulbs-poll-cover"},t.data.thumbnail?s["default"].createElement(o["default"],{image:t.data.thumbnail}):null,s["default"].createElement("h1",{className:"bulbs-poll-cover-title"},t.data.question_text))}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=l;var n=a(1),s=r(n),u=a(192),o=r(u);l.propTypes={poll:n.PropTypes.object.isRequired}},193:function(e,t,a){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function l(e){var t=i["default"],a="bulbs-poll-answers";"imageText"===e.poll.data.answer_type&&(t=d["default"],a="bulbs-poll-image-answers");var r=(0,p["default"])(a,{"bulbs-poll-answers-selected":e.selectedAnswer.id});return u["default"].createElement("ul",{className:r},e.answers.map(function(a,r){return u["default"].createElement(t,n({key:r,answer:a},e))}))}Object.defineProperty(t,"__esModule",{value:!0});var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e};t["default"]=l;var s=a(1),u=r(s),o=a(194),i=r(o),c=a(197),d=r(c),f=a(195),p=r(f);l.propTypes={answers:s.PropTypes.array.isRequired,poll:s.PropTypes.object.isRequired,selectAnswer:s.PropTypes.func.isRequired,selectedAnswer:s.PropTypes.object.isRequired}},194:function(e,t,a){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function l(e){var t=e.answer,a=e.selectAnswer,r=e.selectedAnswer,l=t.id===r.id,n=(0,o["default"])("bulbs-poll-answer",{"bulbs-poll-answer-selected":l});return s["default"].createElement("li",{"data-track-label":"Option",className:n,onClick:a.bind(null,t)},s["default"].createElement(c["default"],{isSelected:l}),t.answer_text)}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=l;var n=a(1),s=r(n),u=a(195),o=r(u),i=a(196),c=r(i);l.propTypes={answer:n.PropTypes.object.isRequired,selectAnswer:n.PropTypes.func.isRequired,selectedAnswer:n.PropTypes.object}},196:function(e,t,a){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function l(e){var t=e.isSelected;return s["default"].createElement("svg",{width:"20px",height:"20px"},s["default"].createElement("circle",{cx:"10",cy:"10",r:"8",fill:"none",stroke:"black",strokeWidth:"2px"}),s["default"].createElement("circle",{cx:"10",cy:"10",r:"5",fill:t?"black":"none"}))}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=l;var n=a(1),s=r(n);l.propTypes={isSelected:n.PropTypes.bool}},197:function(e,t,a){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function l(e){var t=e.answer,a=e.selectAnswer,r=e.selectedAnswer,l=t.id===r.id,n=(0,o["default"])("bulbs-poll-image-answer",{"bulbs-poll-answer-selected":l});return s["default"].createElement("li",{"data-track-label":"Option",className:n,onClick:a.bind(null,t)},s["default"].createElement("img",{src:t.answer_image_url}),s["default"].createElement("div",{className:"answer-image-text"},s["default"].createElement(c["default"],{isSelected:l}),t.answer_text))}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=l;var n=a(1),s=r(n),u=a(195),o=r(u),i=a(196),c=r(i);l.propTypes={answer:n.PropTypes.object.isRequired,selectAnswer:n.PropTypes.func.isRequired,selectedAnswer:n.PropTypes.object}},198:function(e,t,a){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function l(e){function t(){a&&e.makeVoteRequest(a)}var a=e.selectedAnswer,r=!0;a&&a.id&&(r=!1);var l=(0,o["default"])("bulbs-poll-vote",{"bulbs-poll-footer":!0});return s["default"].createElement("button",{"data-track-label":"Submit",className:l,onClick:t,disabled:r},"Vote")}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=l;var n=a(1),s=r(n),u=a(195),o=r(u);l.propTypes={makeVoteRequest:n.PropTypes.func,selectedAnswer:n.PropTypes.object}},199:function(e,t,a){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function l(e){var t=e.error,a=e.children,r=e.reset;return t?s["default"].createElement("div",{className:"bulbs-poll-network-error"},s["default"].createElement("p",null,a),s["default"].createElement("button",{onClick:r},"OK")):s["default"].createElement("div",null)}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=l;var n=a(1),s=r(n)},200:function(e,t,a){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function l(e){var t=(0,o["default"])("bulbs-poll-results",{}),a=e.data,r=a.poll,l=a.winningAnswers,n=a.vote;return s["default"].createElement("div",{className:t},s["default"].createElement(c["default"],{poll:r}),s["default"].createElement(f["default"],{poll:r,winningAnswers:l,vote:n}),s["default"].createElement("div",{className:"bulbs-poll-thank-you bulbs-poll-footer"},"Thanks for voting!"))}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=l;var n=a(1),s=r(n),u=a(195),o=r(u),i=a(191),c=r(i),d=a(201),f=r(d);l.propTypes={data:n.PropTypes.object.isRequired}},201:function(e,t,a){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function l(e){var t=e.poll,a=e.winningAnswers,r=e.vote,l=o["default"],n="bulbs-poll-results-list";return"imageText"===e.poll.data.answer_type&&(l=c["default"],n="bulbs-poll-image-results-list"),s["default"].createElement("ul",{className:n},t.data.answers.map(function(e,n){return s["default"].createElement(l,{key:n,answer:e,poll:t,vote:r,winningAnswers:a})}))}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=l;var n=a(1),s=r(n),u=a(202),o=r(u),i=a(203),c=r(i);l.propTypes={poll:n.PropTypes.object.isRequired,vote:n.PropTypes.object.isRequired,winningAnswers:n.PropTypes.array.isRequired}},202:function(e,t,a){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function l(e){var t=e.answer,a=e.poll,r=e.vote,l=e.winningAnswers,n=(0,f["default"])(l,function(e){return e.sodahead_id===t.sodahead_id}),u=!(!r.data||r.data.answer.id!==t.sodahead_id),i=(0,o["default"])("bulbs-poll-result",{"bulbs-poll-result-winning":n,"bulbs-poll-result-selected":u}),d=t.total_votes,p=void 0;p=a.data.total_votes>1?d/a.data.total_votes*100:100*d;var b=p.toFixed(0)+"%";return s["default"].createElement("li",{className:i},s["default"].createElement("div",{className:"bulbs-poll-answer-bar",style:{width:b}}),s["default"].createElement("div",{className:"bulbs-poll-answer-title"},s["default"].createElement(c["default"],{isSelected:u}),s["default"].createElement("span",{className:"bulbs-poll-answer-text"},t.answer_text),s["default"].createElement("span",{className:"bulbs-poll-answer-result"},b)))}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=l;var n=a(1),s=r(n),u=a(195),o=r(u),i=a(196),c=r(i),d=a(179),f=r(d);l.propTypes={answer:n.PropTypes.object.isRequired,poll:n.PropTypes.object.isRequired,vote:n.PropTypes.object.isRequired,winningAnswers:n.PropTypes.array.isRequired}},203:function(e,t,a){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function l(e){var t=e.answer,a=e.poll,r=e.vote,l=e.winningAnswers,n=(0,f["default"])(l,function(e){return e.sodahead_id===t.sodahead_id}),u=!(!r.data||r.data.answer.id!==t.sodahead_id),i=(0,o["default"])("bulbs-poll-image-result",{"bulbs-poll-result-winning":n,"bulbs-poll-result-selected":u}),d=t.total_votes,p=void 0;p=a.data.total_votes>1?d/a.data.total_votes*100:100*d;var b=p.toFixed(0)+"%";return s["default"].createElement("li",{className:i},s["default"].createElement("div",{className:"result-image-list-item"},s["default"].createElement("div",{className:"bulbs-poll-image-answer-bar",style:{height:b}}),s["default"].createElement("div",{className:"bulbs-poll-image-answer-title"},s["default"].createElement("img",{src:t.answer_image_url}),s["default"].createElement("div",{className:"answer-image-text"},s["default"].createElement(c["default"],{isSelected:u}),s["default"].createElement("span",{className:"bulbs-poll-image-answer-text"},t.answer_text)))),s["default"].createElement("div",{className:"bulbs-poll-answer-result"},b))}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=l;var n=a(1),s=r(n),u=a(195),o=r(u),i=a(196),c=r(i),d=a(179),f=r(d);l.propTypes={answer:n.PropTypes.object.isRequired,poll:n.PropTypes.object.isRequired,vote:n.PropTypes.object.isRequired,winningAnswers:n.PropTypes.array.isRequired}},204:function(e,t,a){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function l(e){var t=e.data,a=t.poll,r=t.winningAnswers,l=t.vote;return s["default"].createElement("div",{className:"bulbs-poll-ended"},s["default"].createElement(o["default"],{poll:a}),s["default"].createElement(c["default"],{poll:a,winningAnswers:r,vote:l}),s["default"].createElement("div",{className:"bulbs-poll-ended-message bulbs-poll-footer"},"Poll Closed"))}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=l;var n=a(1),s=r(n),u=a(191),o=r(u),i=a(201),c=r(i);l.propTypes={data:n.PropTypes.object.isRequired}},205:function(e,t,a){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function l(){return s["default"].createElement("div",{className:"bulbs-poll-coming-soon"},s["default"].createElement("div",{className:"bulbs-poll-coming-soon-message"},"Poll Coming Soon"),s["default"].createElement(o["default"],null))}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=l;var n=a(1),s=r(n),u=a(198),o=r(u)},206:function(e,t){}});
//# sourceMappingURL=bulbs-poll.js.map